<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MixTool - Professional Mastering</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #progress-container { display: none; margin-top: 20px; }
        #progress-bar { width: 100%; background-color: #ddd; height: 25px; }
        #progress-bar-fill { height: 100%; width: 0%; background-color: #4CAF50; }
    </style>
</head>
<body>

    <h1>Upload a Track for Perfect Mastering</h1>
    
    <label for="mixType">Select Mastering Style:</label>
    <select id="mixType">
        <option value="Studio Master">Studio Master (Clean & Balanced)</option>
        <option value="Lo-Fi">Lo-Fi (Warm, Vintage Feel)</option>
        <option value="Trap">Trap (Crisp & Punchy)</option>
        <option value="Pop">Pop (Bright & Radio-Ready)</option>
    </select>
    
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload & Process</button>

    <div id="progress-container">
        <p>Processing... Please wait</p>
        <div id="progress-bar"><div id="progress-bar-fill"></div></div>
    </div>

    <p id="status"></p>

    <script>
        function uploadFile() {
            let fileInput = document.getElementById("fileInput").files[0];
            let mixType = document.getElementById("mixType").value;
            let formData = new FormData();
            formData.append("file", fileInput);
            formData.append("mix_type", mixType);

            let progressBar = document.getElementById("progress-container");
            let progressFill = document.getElementById("progress-bar-fill");
            progressBar.style.display = "block";
            progressFill.style.width = "0%";

            let progress = 0;
            let interval = setInterval(() => {
                progress += 10;
                if (progress >= 100) clearInterval(interval);
                progressFill.style.width = progress + "%";
            }, 1000);

            fetch("/upload", {
                method: "POST",
                body: formData
            })
            .then(response => response.blob())
            .then(blob => {
                clearInterval(interval);
                progressFill.style.width = "100%";

                let url = window.URL.createObjectURL(blob);
                let a = document.createElement("a");
                a.href = url;
                a.download = "final_master.wav";
                document.body.appendChild(a);
                a.click();
                document.getElementById("status").innerText = "Download Ready!";
            })
            .catch(error => console.error("Error:", error));
        }
    </script>

</body>
</html>
